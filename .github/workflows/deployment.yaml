name: Dispatch Deploy

on:
  workflow_dispatch:
    inputs:
      network:
        description: "Select Network"
        required: true
        type: choice
        options:
          - "Baobab"
          - "Cypress"
      application:
        description: "Select Application"
        required: true
        type: string
        default: "default" # Temporary default to allow workflow to start
      image:
        description: "Select Image Version"
        required: true
        type: choice
        default: "new"
        options:
          - "new"

jobs:
  set-application-options:
    name: Set Application Options
    runs-on: ubuntu-latest
    outputs:
      applications: ${{ steps.set-vars.outputs.applications }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up GitHub CLI
        uses: cli/gh-action@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Determine Applications
        id: set-vars
        run: |
          if [ "${{ github.event.inputs.network }}" == "Baobab" ]; then
            applications="cli,aggregator,vrf,api"
          elif [ "${{ github.event.inputs.network }}" == "Cypress" ]; then
            applications="request-response,delegator,fetcher,por"
          else
            applications="default"
          fi
          echo "applications=${applications}" >> $GITHUB_OUTPUT

  display-application-options:
    name: Display Application Options
    runs-on: ubuntu-latest
    needs: set-application-options

    steps:
      - name: Output Applications
        run: |
          echo "Available applications for ${GITHUB_EVENT_INPUTS_NETWORK}: ${needs.set-application-options.outputs.applications}"
